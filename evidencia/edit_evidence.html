{% extends 'principal.html' %}

{% block content %}
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        {% load static %}
        <script src="{% static 'js/jquery.inputmask.min.js' %}"></script>
        <style>
            .form-control{
                height: 40px;
            }
        </style>
    </head>
    <body style="background-color: #ddd;">
        <form action="{% url 'edit_evidence' evidencia.id %}" method="post" class="card"
        style="display: flex; gap: 20px;  width: 80%; flex-direction: column;
        background-color: #f8f9fa; padding: 10px; border-radius: 10px;
         align-self: center; align-items: center;">

            {% csrf_token %}
            <div class="d-flex justify-content-between"
             style="width: 100%;">
                <h3  class="text-warning">Atualização de Evidências</h3>
                <a href="/list_evidence/" class="btn btn-primary">Listar</a>
            </div>
            {% if messages %}
                {% for message in messages %}
                    {% if message.tags == 'success' %}
                    
                        <div class="alert alert-{{message.tags}} alert-dismissible fade show" role="alert">
                            <strong>{{message}}</strong>
                            <button type="button" class="btn-close"
                            data-bs-dismiss="alert" aria-label="close"
                            ></button>
                        </div>
                    {% else %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <strong>{{message}}</strong>
                            <button type="button" class="btn-close"
                            data-bs-dismiss="alert" aria-label="close"
                            ></button>
                        </div>
                    {% endif %}
                
                {% endfor %}
            {% endif %}
          

            <div class="form-group" 
            style="display: flex; gap: 20px;  width: 100%;">

                <label for="local_coleta" 
                style="display: flex; flex-direction: column;  width: 100%;">
                    
                    <span >
                        Local da coleta
                        <span class="text-danger">*</span>
                    </span>
                    <input type="text" style=" width: 100%;" value="{{evidencia.local_coleta}}"
                        class="form-control" name="local_coleta" 
                        aria-describedby="helpId" autocomplete="off">
                        
                    {% if form.local_coleta.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.local_coleta.errors}}
                        </div>
                    {% endif %}
                </label>
            </div>

            <div class="form-group" 
                style="display: flex; gap: 20px;  width: 100%; margin-top: 10px;">
                
                <label for="custodia_atual" style="display: flex;
                 flex-direction: column; width: 100%;">

                    <span >
                        Custódia atual 
                        <span class="text-danger">*</span>
                    </span>
        
                    <select name="custodia_atual" class="form-control" >
                        <option value="{{evidencia.custodia_atual.id}}">{{evidencia.custodia_atual.get_full_name}} </option>
                        {% for user in users %}
                            <option value="{{user.id}}">{{user.get_full_name}}</option>
                        {% endfor %}
                    
                    </select>

                    {% if form.custodia_atual.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.custodia_atual.errors}}
                        </div>
                    {% endif %}
                </label>
                
                <label for="coletado_por" style="display: flex;
                 flex-direction: column; width: 100%;">

                    <span >
                        Coletado por: 
                        <span class="text-danger">*</span>
                    </span>
                    <select name="coletado_por" class="form-control" >
                        <option value="{{evidencia.coletado_por.id}}">{{evidencia.coletado_por.get_full_name}}</option>
                        {% for user in users %}
                            <option value="{{user.id}}">{{user.get_full_name}}</option>
                        {% endfor %}
                  
                    </select>

                    {% if form.coletado_por.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.coletado_por.errors}}
                        </div>
                    {% endif %}
                </label>
            </div>

            <div class="form-group" 
            style="display: flex; gap: 20px;  width: 100%;">

                <label for="dimensoes" 
                    style="display: flex; flex-direction: column;  width: 100%;">

                    Dimensões
                    <input type="text" style=" width: 100%;" value="{{evidencia.dimensoes}}"
                        class="form-control" name="dimensoes" 
                        aria-describedby="helpId" autocomplete="off">
                        
                    {% if form.dimensoes.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.dimensoes.errors}}
                        </div>
                    {% endif %}
                </label>

                <label for="material" 
                style="display: flex; flex-direction: column;  width: 100%;">

                    Material
                    <input type="text" style=" width: 100%;" value="{{evidencia.material}}"
                        class="form-control" name="material" 
                        aria-describedby="helpId" autocomplete="off">
                        
                    {% if form.material.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.material.errors}}
                        </div>
                    {% endif %}
                </label>
            </div>
            
            <div class="form-group" 
            style="display: flex; gap: 20px;  width: 100%;">
                <label for="peso" 
                style="display: flex; flex-direction: column;  width: 100%;">

                    Peso
                    {{form.peso}}
                        
                        {% if form.peso.errors %}
                            <div class="text-danger" style="margin-bottom: -40px; ">
                                {{form.peso.errors}}
                            </div>
                        {% endif %}
                </label>
    
                <label for="valor_estimado" style="display: flex;
                 width: 100%; flex-direction: column;">

                    Valor estimado
                    {{form.valor_estimado}}
                    {% if form.valor_estimado.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.valor_estimado.errors}}
                        </div>
                    {% endif %}
                </label>
            </div>
    
            <div class="form-group" 
                style="display: flex; gap: 20px;  width: 100%; margin-top: 10px;">
                
                <label for="tipo" style="display: flex;
                 flex-direction: column; width: 100%;">

                    <span >
                        Tipo de evidência 
                        <span class="text-danger">*</span>
                    </span>
        
                    <select name="tipo" class="form-control" >
                        <option value="{{evidencia.tipo.id}}">{{evidencia.tipo.nome}} </option>
                        {% for tipo in tipos %}
                         <option value="{{tipo.id}}">{{tipo.nome}}</option>
                        {% endfor %}
                       
                    </select>

                    {% if form.tipo.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.tipo.errors}}
                        </div>
                    {% endif %}
                </label>
                
                <label for="status" style="display: flex;
                 flex-direction: column; width: 100%;">

                    <span >
                        Status
                        <span class="text-danger">*</span>
                    </span>
                    <select name="status" class="form-control" >
                        <option value="{{evidencia.status}}">{{evidencia.get_status_display}}</option>
                        <option value="coletada">Coletada</option>
                        <option value="em_analise">Em análise</option>
                        <option value="analisada">Analisada</option>
                        <option value="devolvida">Devolvida</option>                
                        <option value="destruida">Destruída</option>                
                    </select>

                    {% if form.status.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.status.errors}}
                        </div>
                    {% endif %}
                </label>
            </div>

            <div class="form-group" 
                style="display: flex; gap: 20px;  width: 100%; margin-top: 10px;">
                
                <label for="local_armazenamento" style="display: flex;
                 flex-direction: column; width: 100%;">

                    <span >
                        Local de armazenamento: 
                        <span class="text-danger">*</span>
                    </span>
                    <input type="text" class="form-control" value="{{evidencia.local_armazenamento}}"
                    name="local_armazenamento" id="local_armazenamento">

                    {% if form.local_armazenamento.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.local_armazenamento.errors}}
                        </div>
                    {% endif %}
                </label>

                <label for="data_coleta" style="display: flex;
                flex-direction: column; width: 100%;">

                    <span >
                        Data da coleta
                        <span class="text-danger">*</span>
                    </span>
                    <input type="datetime-local" style=" width: 100%;" value="{{evidencia.data_coleta}}"
                    class="form-control" name="data_coleta" autocomplete="off"
                    aria-describedby="helpId">

                    {% if form.data_coleta.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.data_coleta.errors}}
                        </div>
                    {% endif %}
                </label>
            </div>

            <div class="form-group" 
            style="display: flex; gap: 20px;  width: 100%; margin-top: 10px;">

                <label for="descricao" style="display: flex;
                flex-direction: column; width: 100%;">
            
                    <span >
                        Descrição
                    <span class="text-danger">*</span>
                    </span>
                    <textarea  name="descricao" class="form-control" 
                    style="height: 70px; resize: none;"
                    >{{evidencia.descricao}}</textarea>

                    {% if form.descricao.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.descricao.errors}}
                        </div>
                    {% endif %}
                  
                </label>

                <label for="observacoes" style="display: flex;
                flex-direction: column; width: 100%;">
            
                    Observações
                    <textarea  name="observacoes" class="form-control" 
                    style="height: 70px; resize: none;"
                    >{{evidencia.observacoes}}</textarea>

                    {% if form.observacoes.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.observacoes.errors}}
                        </div>
                    {% endif %}
                  
                </label>
            </div>
            
            <div class="form-group" 
            style="display: flex; gap: 20px;  width: 100%; margin-top: 10px;">
            
                <label for="estado_conservacao" style="display: flex;
                flex-direction: column; width: 100%;">

                    Estado da conservação
                    <input type="text"  name="estado_conservacao"  value="{{evidencia.estado_conservacao}}"
                    class="form-control" />

                    {% if form.estado_conservacao.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.estado_conservacao.errors}}
                        </div>
                    {% endif %}
                </label>

                <label for="numero_lacre" style="display: flex;
                flex-direction: column; width: 100%;">

                    Número de lacre
                    <input type="text" name="numero_lacre" value="{{evidencia.numero_lacre}}"
                    class="form-control"/>

                    {% if form.numero_lacre.errors %}
                        <div class="text-danger" style="margin-bottom: -40px; ">
                            {{form.numero_lacre.errors}}
                        </div>
                    {% endif %}
                </label>
            </div>

            <button type="submit" class="btn" 
            style="width: 80%; background-color: #2c5aa0; color: #fff;">
                Cadastrar
            </button>
        </form> 
        <script>
            function formatDecimal(input, min, max) {
              let value = input.value.replace(',', '.'); // troca vírgula por ponto
              if (isNaN(value)) {
                input.value = "";
                return;
              }
              let num = parseFloat(value).toFixed(8); // fixa 8 casas
              if (num < min || num > max) {
                alert("Valor fora do intervalo permitido");
                input.value = "";
              } else {
                input.value = num;
              }
            }
            
            document.getElementById("la").addEventListener("blur", function(){
              formatDecimal(this, -90, 90);
            });
            
            document.getElementById("lo").addEventListener("blur", function(){
              formatDecimal(this, -180, 180);
            });
            </script>
            
    </body>
    </html>
{% endblock content %}